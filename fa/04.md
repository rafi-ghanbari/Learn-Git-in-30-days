# روز ۰۴: دستورات رایج کنترل نسخه Git

این مقاله به شما کمک می‌کند تا چندین مورد از مهم‌ترین و اساسی‌ترین وظایف کنترل نسخه را یاد بگیرید، از جمله عملیات پایه فایل مانند اضافه کردن، حذف کردن، تغییر نام فایل‌ها، ثبت تغییرات (ایجاد نسخه‌های جدید) و استعلام سوابق تاریخچه.

## آماده‌سازی دایرکتوری کاری

با مرور محتوای مقاله قبلی "روز ۰۳: ایجاد یک مخزن"، بیایید مستقیماً یک مخزن محلی (local repository) ایجاد کنیم تا تمام تمرینات این مقاله را شروع کنیم.

```
mkdir git-demo
cd git-demo
git init
```

## اضافه کردن فایل‌ها

بیایید چند فایل را در دایرکتوری کاری (working directory) قرار دهیم. هر فایلی مناسب است؛ فقط برخی از فایل‌ها و دایرکتوری‌های موجود را در دایرکتوری کاری فعلی کپی کنید.

برای این مقاله، من از ابزار [YEOMAN](https://yeoman.io/) استفاده می‌کنم تا به سرعت یک وب‌سایت نمونه webapp تولید کنم. تنها با یک دستور، می‌توانید یک وب‌سایت کامل ایجاد کنید:

```
yo webapp
```

**توجه**: در مورد استفاده از [YEOMAN](https://yeoman.io/) در پلتفرم ویندوز، می‌توانید به مقاله نویسنده با عنوان [نحوه نصب و استفاده از ابزارهای مرتبط با Yeoman 1.0 در پلتفرم ویندوز](https://blog.miniasp.com/post/2013/08/11/Yeoman-1-0-Installation-and-Usage-on-Windows) مراجعه کنید که فرآیند کامل نصب و استفاده را با جزئیات شرح می‌دهد.

پس از اضافه کردن فایل‌ها، اگر هنوز در رابط Git Shell هستید، باید بلافاصله پیامی مانند زیر را ببینید:

![image](figures/04/01.png)

یعنی پیام زیر که بعد از مسیر قرار دارد:

```
[master +10 ~0 -0 !]
```

در این بخش پیام، می‌توانید چندین مورد را مشاهده کنید:

* **master** نشان‌دهنده این است که دایرکتوری کاری فعلی در شاخه **master** است که نام شاخه پیش‌فرض Git نیز می‌باشد.
* اعداد "قرمز" همگی نشان‌دهنده فایل‌های Untracked (ردیابی نشده) هستند، به این معنی که این تغییرات وارد کنترل نسخه نمی‌شوند.
* +10 نشان‌دهنده ۱۰ فایل اضافه شده (added) است.
* ~0 نشان‌دهنده ۰ فایل تغییر یافته (modified) است.
* -0 نشان‌دهنده ۰ فایل حذف شده (deleted) است.

اگر می‌خواهید این فایل‌های جدید را به کنترل نسخه Git اضافه کنید، باید دستور زیر را اجرا کنید:

```
git add .
```

به این ترتیب، تمام فایل‌ها، دایرکتوری‌ها و تمام فایل‌های موجود در زیردایرکتوری‌های این دایرکتوری کاری همگی به [ایندکس] یا [کش] این دایرکتوری کاری Git اضافه می‌شوند. لطفاً توجه داشته باشید: در این زمان، هنوز هیچ نسخه‌ای ایجاد نشده است. این فقط به Git می‌گوید که این فایل‌ها "در شرف" اضافه شدن به مخزن Git هستند.

همانطور که در شکل زیر نشان داده شده است، این نتیجه اجرای `git add .` در اینجا است. پیام هشداری که در اینجا رخ می‌دهد خیلی جدی نیست. کسانی که علاقه‌مند به درک آن هستند می‌توانند به مقاله دیگری از نویسنده مراجعه کنند: [نکاتی در مورد تبدیل پایان خط (CRLF) در Git for Windows](https://blog.miniasp.com/post/2013/09/15/Git-for-Windows-Line-Ending-Conversion-Notes).

![image](figures/04/02.png)

اما آنچه جالب است این است که "اعداد قرمز" اصلی اکنون به "اعداد سبز" تبدیل شده‌اند. معنای نمایش داده شده در اینجا این است:

* اعداد "سبز" همگی نشان‌دهنده فایل‌های Staged (آماده شده) هستند، به این معنی که این تغییرات وارد کنترل نسخه خواهند شد.
* +23 نشان‌دهنده ۲۳ فایل اضافه شده (added) است که به عنوان یک نسخه ایجاد می‌شوند.
* ~0 نشان‌دهنده ۰ فایل تغییر یافته (modified) است که به عنوان یک نسخه ایجاد می‌شوند.
* -0 نشان‌دهنده ۰ فایل حذف شده (deleted) است که به عنوان یک نسخه ایجاد می‌شوند.

اما مگر در ابتدا فقط +10 (قرمز) نبود؟ پس از اجرا چگونه به +23 (سبز) تبدیل شد؟

ما دستور `git reset` را برای بازنشانی (reset) وضعیت ایندکس دایرکتوری کاری اجرا می‌کنیم، سپس دوباره دستور `git status` را برای استعلام وضعیت دقیق دایرکتوری کاری فعلی اجرا می‌کنیم، همانطور که در شکل زیر نشان داده شده است:

![image](figures/04/03.png)

می‌بینید که در اینجا فقط "فایل‌ها و دایرکتوری‌های تحت دایرکتوری سطح اول" لیست شده‌اند زیرا گیت در این زمان بررسی نمی‌کند که چه تعداد فایل در زیردایرکتوری‌ها ردیابی نشده‌اند.

وقتی دستور `git add .` را اجرا می‌کنیم و سپس دوباره دستور `git status` را برای استعلام وضعیت اجرا می‌کنیم، می‌توانید متوجه شوید که تمام فایل‌های موجود در زیردایرکتوری‌ها اضافه شده‌اند، بنابراین این عدد افزایش می‌یابد، همانطور که در شکل زیر نشان داده شده است:

![image](figures/04/04.png)

## اضافه کردن فایل‌های جزئی

دستور `git add .` که به آن اشاره شد به طور خودکار تمام فایل‌ها (شامل فایل‌های موجود در زیردایرکتوری‌ها) را به ایندکس دایرکتوری کاری اضافه می‌کند. گاهی اوقات ما فقط می‌خواهیم دایرکتوری‌های خاص یا فایل‌های خاصی را به نسخه اضافه کنیم. در این زمان، می‌توانید دایرکتوری‌های خاصی را مشخص کنید یا از وایلدکاردها (wildcards) برای اضافه کردن فایل‌ها استفاده کنید.

بیایید دوباره دستور `git reset` را برای بازنشانی وضعیت ایندکس دایرکتوری کاری اجرا کنیم، سپس از `git add app` برای اضافه کردن پوشه app و تمام فایل‌های زیر آن استفاده کنیم، و از `git add .*` برای اضافه کردن تمام فایل‌هایی که با یک "نقطه" شروع می‌شوند استفاده کنیم، همانطور که در شکل زیر نشان داده شده است:

![image](figures/04/05.png)

**توجه**: وایلدکارد `.*` نمی‌تواند به درستی تمام فایل‌های "نقطه‌دار" را اضافه کند، زیرا در بسیاری از پوسته‌ها (shells) با دایرکتوری‌های `.` و `..` نیز مطابقت پیدا می‌کند. برای جلوگیری از این مشکل و انتخاب فایل‌هایی که با نقطه شروع می‌شوند، می‌توانید از الگوی دقیق‌تری مانند `.??*` استفاده کنید.

## ثبت تغییرات (Committing Changes)

پس از اضافه کردن فایل‌ها به ایندکس (index)، می‌توانید تغییرات را برای ایجاد یک نسخه ثبت (commit) کنید. دستور ثبت به صورت زیر است:

```
git commit -m "Initial commit"
```

پارامتر `-m` با پیامِ کامیت (commit message) همراه است. این پیام در تاریخچه نسخه‌ها ثبت خواهد شد. توصیه می‌شود پیام‌های معنی‌داری بنویسید تا به شما و دیگران کمک کند در آینده هدف از این نسخه را درک کنید.

![image](figures/04/06.png)

## مشاهده تاریخچه ثبت (Commit History)

پس از ثبت کردن (committing)، می‌توانید از دستور `git log` برای مشاهده تاریخچه ثبت استفاده کنید:

```
git log
```

![image](figures/04/07.png)

همچنین می‌توانید از پارامتر `git log --oneline` برای نمایش نسخه ساده شده لاگ استفاده کنید:

```
git log --oneline
```

![image](figures/04/08.png)

## تغییر فایل‌ها

حالا بیایید تغییر دادن فایل‌ها را امتحان کنیم. هر فایلی را در دایرکتوری کاری باز کنید، مقداری تغییر ایجاد کنید و سپس آن را ذخیره کنید.

پس از تغییر، اگر `git status` را اجرا کنید، اطلاعات مربوط به فایل‌های تغییر یافته را خواهید دید:

![image](figures/04/09.png)

می‌بینید که فایل‌های تغییر یافته با رنگ قرمز نمایش داده می‌شوند و تعداد فایل‌های تغییر یافته به صورت ~1 نمایش داده می‌شود.

## مشاهده تفاوت‌های فایل (File Differences)

قبل از ثبتِ فایل‌های تغییر یافته، ممکن است بخواهید ببینید چه تغییراتی ایجاد شده است. می‌توانید از دستور `git diff` استفاده کنید:

```
git diff
```

![image](figures/04/10.png)

دستور git diff تفاوت‌های بین دایرکتوری کاری و ایندکس را نمایش می‌دهد.

## ثبت فایل‌های تغییر یافته

برای ثبتِ فایل‌های تغییر یافته، باید ابتدا دستور `git add` را اجرا کنید تا فایل‌های تغییر یافته به ایندکس اضافه شوند، سپس دستور `git commit` را اجرا کنید:

```
git add .
git commit -m "Update files"
```

![image](figures/04/11.png)

## حذف فایل‌ها

اگر می‌خواهید فایل‌ها را حذف کنید و این عمل حذف در نسخه ثبت شود، می‌توانید از دستور `git rm` استفاده کنید:

```
git rm [filename]
```

پس از اجرای این دستور، فایل هم از دایرکتوری کاری و هم از ایندکس حذف خواهد شد. سپس دستور `git commit` را برای ثبت این عمل حذف اجرا کنید.

![image](figures/04/12.png)

## تغییر نام یا انتقال فایل‌ها

اگر می‌خواهید فایل‌ها را تغییر نام دهید یا جابجا کنید، می‌توانید از دستور `git mv` استفاده کنید:

```
git mv [old_filename] [new_filename]
```

این دستور فایل را تغییر نام داده یا جابجا می‌کند و به طور خودکار این تغییر را به ایندکس اضافه می‌کند. سپس دستور `git commit` را برای ثبت این تغییر اجرا کنید.

![image](figures/04/13.png)

## خلاصه امروز

امروز ما چندین دستور اساسی Git را یاد گرفتیم که به شرح زیر خلاصه می‌شوند:

* `git add [file]` - اضافه کردن فایل‌ها به ایندکس (index)
* `git add .` - اضافه کردن تمام فایل‌های دایرکتوری فعلی به ایندکس
* `git commit -m "message"` - ثبت تغییرات از ایندکس برای ایجاد یک نسخه جدید
* `git status` - مشاهده وضعیت فعلی دایرکتوری کاری (working directory)
* `git log` - مشاهده تاریخچه ثبت (commit history)
* `git log --oneline` - مشاهده تاریخچه ثبت ساده شده
* `git diff` - مشاهده تفاوت‌های بین دایرکتوری کاری و ایندکس
* `git rm [file]` - حذف فایل‌ها از دایرکتوری کاری و ایندکس
* `git mv [old] [new]` - تغییر نام یا جابجایی فایل‌ها
* `git reset` - بازنشانی وضعیت ایندکس

## لینک‌های مرجع

* [Git - Recording Changes to the Repository](https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository)

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: ایجاد یک مخزن (Repository)](03.md)
* [روز بعد: درک رابطه بین مخزن (Repository)، دایرکتوری کاری (Working Directory)، اشیاء (Objects) و ایندکس (Index)](05.md)

---
