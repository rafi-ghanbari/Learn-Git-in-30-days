# روز ۲۶: کار تیمی چندین نفر در یک مخزن راه دور (Remote Repository)

وقتی چندین نفر در یک مخزن (repository) مشترک کار می‌کنند، هماهنگی و درک گردش‌های کار گیت (Git workflows) بسیار حیاتی می‌شود. این مقاله بهترین تجربه‌ها و سناریوهای رایج برای همکاری تیمی را بررسی می‌کند.

## چالش‌های رایج در همکاری تیمی

۱. **تداخل‌های ادغام (Merge conflicts)**: ویرایش فایل‌های یکسان توسط چندین نفر.
۲. **شاخه‌های منحرف شده (Diverging branches)**: ناهماهنگ شدن شاخه‌های محلی و راه دور.
۳. **کامیت‌های از دست رفته**: بازنویسی تصادفی کارهای دیگران.
۴. **شکاف‌های ارتباطی**: ندانستن اینکه دیگران روی چه چیزی کار می‌کنند.

## گردش کار پایه تیمی

### گردش کار روزانه

```
# صبح: دریافت آخرین تغییرات
git pull origin main

# ایجاد شاخه قابلیت (feature branch)
git checkout -b feature-name

# کار کردن و کامیت کردن مکرر
git add .
git commit -m "پیشرفت در پیاده‌سازی قابلیت"

# قبل از اتمام: به‌روزرسانی با آخرین تغییرات شاخه اصلی
git checkout main
git pull origin main
git checkout feature-name
git merge main

# حل هرگونه تداخل احتمالی

# ارسال (push) شاخه خودتان
git push origin feature-name

# ایجاد درخواست Pull Request برای بازبینی کد
```

### به‌روز ماندن

مرتباً تغییرات را دریافت (fetch) کنید:

```
# بررسی تغییرات ایجاد شده
git fetch origin

# مشاهده تغییرات ریموت
git log main..origin/main

# در صورت لزوم، ادغام (merge) کنید
git merge origin/main
```

## مدیریت کارهای همزمان

### سناریو ۱: فایل‌های یکسان، خطوط متفاوت

معمولاً ادغام به صورت خودکار انجام می‌شود:

```
git pull origin main
# اگر ادغام خودکار موفقیت‌آمیز باشد، کار تمام است!
```

### سناریو ۲: فایل‌های یکسان، خطوط یکسان

نیاز به حل دستی تداخل دارد:

```
git pull origin main
# تداخل (Conflict)!

# ویرایش فایل‌های دارای تداخل
# حذف نشانگرها: <<<<<<<, =======, >>>>>>>
# نگه داشتن تغییرات صحیح

# آماده‌سازی (Stage) فایل‌های حل شده
git add resolved-file.txt

# تکمیل فرآیند ادغام
git commit
```

### سناریو ۳: یک نفر Rebase انجام داده است

اگر شاخه مشترک باشد، می‌تواند مشکلات بزرگی ایجاد کند:

```
# اگر کسی یک شاخه مشترک را ری‌بیس کرده باشد
git fetch origin

# شما باید کارهای خود را ری‌بیس کنید
git rebase origin/feature-branch

# یا از ابتدا شروع کنید
git reset --hard origin/feature-branch
```

## فرآیند بازبینی کد (Code Review)

### ایجاد درخواست Pull Request مناسب

۱. **عنوان توصیفی**: "افزودن قابلیت احراز هویت کاربران"
۲. **توضیحات دقیق**:
   * این PR چه کاری انجام می‌دهد؟
   * چرا این تغییر نیاز بود؟
   * چگونه تست شده است؟
۳. **کوچک نگه داشتن PR**: بازبینی PRهای کوچک آسان‌تر است.
۴. **یک موضوع در هر PR**: قابلیت‌ها و اصلاحات باگ را با هم مخلوط نکنید.
۵. **به‌روزرسانی با main**: مطمئن شوید که بدون مشکل ادغام می‌شود.

### بازبینی درخواست‌های Pull Request

۱. منطق و استایل کد را **بررسی کنید**.
۲. در صورت امکان، به صورت **محلی تست کنید**.
۳. **بازخورد سازنده** بدهید.
۴. **تایید کنید** یا درخواست تغییر دهید.
۵. وقتی آماده بود، **ادغام کنید**.

## حل تداخلات تیمی

### اولویت با ارتباطات است

* **با تیم خود صحبت کنید**: اغلب از بروز مشکلات جلوگیری می‌کند.
* **استفاده از کامنت‌های PR**: سوال بپرسید و در مورد رویکردها بحث کنید.
* **مستندسازی تصمیمات**: توضیحات یا کامنت‌های PR را آپدیت کنید.

### راهکارهای فنی

#### حل تداخلات

```
# آپدیت شاخه خودتان
git fetch origin
git merge origin/main

# حل تداخل در فایل‌ها
# آماده‌سازی تغییرات
git add .

# تکمیل ادغام
git commit
```

#### لغو و شروع مجدد

```
# اگر حل تداخل خیلی پیچیده است
git merge --abort

# با توسعه‌دهنده دیگر صحبت کنید
# هماهنگ کنید که چه کسی چه تغییراتی را انجام دهد
```

## قوانین محافظت از شاخه (Branch Protection Rules)

در GitHub، از شاخه‌های مهم محافظت کنید:

۱. **نیاز به بازبینی بازبین‌ها** در Pull Request.
۲. **نیاز به بررسی وضعیت** (CI/CD).
۳. **اجبار به داشتن تاریخچه خطی**.
۴. **شامل شدن مدیران سیستم** در قوانین.

تنظیم در: Settings > Branches > Branch protection rules

## یکپارچه‌سازی مداوم (Continuous Integration)

استفاده از CI برای شناسایی زودهنگام مشکلات:

```yaml
# نمونه فایل .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm test
```

## ابزارهای ارتباطی

### پیام‌های کامیت (Commit Messages)

پیروی از قراردادها:

```
<type>(<scope>): <subject>

<body>

<footer>
```

مثال:

```
feat(auth): add user login functionality

Implement JWT-based authentication with email and password.
Includes password hashing with bcrypt and token refresh.

Closes #123
```

### قالب‌های درخواست Pull Request

ایجاد فایل `.github/pull_request_template.md`:

```markdown
## توضیحات
<!-- تغییرات خود را شرح دهید -->

## نوع تغییر
- [ ] اصلاح باگ
- [ ] قابلیت جدید
- [ ] تغییر کلیدی (Breaking change)

## تست‌ها
<!-- این تغییر چگونه تست شده است؟ -->

## چک‌لیست
- [ ] تست‌ها پاس شده‌اند
- [ ] مستندات آپدیت شده‌اند
- [ ] تداخل ادغام وجود ندارد
```

## مدیریت تیم‌های بزرگ

### پرچم‌های قابلیت (Feature Flags)

انتشار کدهایی که هنوز آماده نیستند:

```javascript
if (featureFlags.newUI) {
  return <NewUI />;
} else {
  return <OldUI />;
}
```

### شاخه‌های انتشار (Release Branches)

جدا کردن توسعه از انتشارها:

```
main (production)
├── release/v2.0
├── release/v1.9
└── develop (integration)
    ├── feature/login
    ├── feature/dashboard
    └── feature/reports
```

## خلاصه بهترین تجربه‌ها

۱. **قبل از Push ابتدا Pull کنید**: همیشه آخرین تغییرات را بگیرید.
۲. **مکرراً Commit کنید**: کامیت‌های کوچک و منطقی بسازید.
۳. **مرتباً Push کنید**: کارهای خود را به اشتراک بگذارید و بازخورد بگیرید.
۴. **از شاخه‌ها استفاده کنید**: شاخه main را پایدار نگه دارید.
۵. **تست بنویسید**: قبل از دیگران، مشکلات را پیدا کنید.
۶. **بازبینی کد کنید**: از یکدیگر یاد بگیرید.
۷. **ارتباط برقرار کنید**: در صورت نیاز، بیش از حد لازم اطلاع‌رسانی کنید.
۸. **مستندسازی**: README، ویکی و کامنت‌ها.
۹. **صبور باشید**: تداخل‌ها رخ می‌دهند، با هم آن‌ها را حل کنید.
۱۰. **به دیگران کمک کنید**: موفقیت تیم، موفقیت شماست.

## خلاصه امروز

همکاری تیمی موفق با گیت نیازمند مهارت‌های فنی و ارتباطات خوب است. درک گردش‌های کار رایج، مدیریت حرفه‌ای تداخل‌ها و استفاده از ابزارهایی مانند Pull Request و CI/CD به تیم شما کمک می‌کند تا به شکلی روان با هم کار کنید.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git pull origin main
* git fetch origin
* git merge origin/main
* git rebase origin/branch
* git push origin branch
* git log main..origin/main

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: مفاهیم استفاده از مخزن راه دور GitHub](25.md)
* [روز بعد: کنترل نسخه از طریق شاخه‌ها در مخزن راه دور یکسان](27.md)

---
