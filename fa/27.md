# روز ۲۷: کنترل نسخه از طریق شاخه‌ها در مخزن راه دور یکسان

تیم‌های مختلف از استراتژی‌های شاخه‌بندی (branching strategies) متفاوتی استفاده می‌کنند. این مقاله مدل‌های رایج شاخه‌بندی و زمان استفاده از هر کدام را بررسی می‌کند.

## چرا استراتژی‌های شاخه‌بندی مهم هستند؟

بدون یک استراتژی روشن:
* تداخل کدها افزایش می‌یابد.
* انتشار نسخه‌ها (Releases) آشفته می‌شود.
* باگ‌ها به محیط عملیاتی (production) نفوذ می‌کنند.
* هماهنگی تیم ضعیف می‌شود.

## روش GitHub Flow

**مناسب برای**: اپلیکیشن‌های وب، استقرار مداوم (continuous deployment).

### استراتژی

* یک شاخه اصلی: `main`.
* شاخه‌های قابلیت (feature branches) برای تمام تغییرات.
* استقرار (deployment) مستقیماً از شاخه `main`.

### گردش کار

```
۱. ایجاد شاخه از main
   git checkout -b feature-name

۲. انجام کار و کامیت کردن
   git commit -am "افزودن قابلیت"

۳. Push کردن و ایجاد PR
   git push origin feature-name

۴. بازبینی و بحث در مورد کد

۵. استقرار از شاخه (محیط تست/staging)

۶. ادغام با main
   # در گیت‌هاب: Merge PR

۷. استقرار از main (محیط عملیاتی/production)
```

### مزایا
* ساده و مستقیم.
* سرعت بالای توسعه.
* شاخه main همیشه آماده استقرار است.
* عالی برای استقرار مداوم (CD).

### معایب
* عدم پشتیبانی از نگهداری نسخه‌های قدیمی در طولانی مدت.
* نیاز به CI/CD قوی.
* برای پروژه‌هایی با چندین نسخه همزمان، ایده‌آل نیست.

## روش Git Flow

**مناسب برای**: نرم‌افزارهای دارای نسخه (release)، چندین نسخه همزمان.

### انواع شاخه‌ها

* **main**: کد آماده تولید (Production-ready).
* **develop**: شاخه ادغام (Integration branch).
* **feature/**: قابلیت‌های جدید.
* **release/**: آماده‌سازی برای انتشار نسخه جدید.
* **hotfix/**: اصلاحات فوری برای باگ‌های بحرانی.

### گردش کار

```
# شروع قابلیت جدید
git checkout -b feature/login develop

# کار روی قابلیت
git commit -am "پیاده‌سازی ورود"

# پایان قابلیت
git checkout develop
git merge --no-ff feature/login
git branch -d feature/login

# شروع انتشار (release)
git checkout -b release/1.0 develop

# آماده‌سازی انتشار (فقط اصلاح باگ)
git commit -am "تغییر شماره نسخه به 1.0"

# پایان انتشار
git checkout main
git merge --no-ff release/1.0
git tag -a 1.0

git checkout develop
git merge --no-ff release/1.0
git branch -d release/1.0

# اصلاح فوری (Hotfix)
git checkout -b hotfix/1.0.1 main
git commit -am "اصلاح باگ بحرانی"

git checkout main
git merge --no-ff hotfix/1.0.1
git tag -a 1.0.1

git checkout develop
git merge --no-ff hotfix/1.0.1
git branch -d hotfix/1.0.1
```

### مزایا
* جداسازی واضح مسئولیت‌ها.
* پشتیبانی از چندین نسخه همزمان.
* فرآیند انتشار ساختارمند.

### معایب
* پیچیدگی بیشتر.
* چرخه توسعه کندتر.
* سربار اضافی برای پروژه‌های ساده.

## روش GitLab Flow

**مناسب برای**: سازمان‌هایی که دارای محیط‌های staging و production هستند.

### استراتژی

* شاخه‌های محیطی: `main`, `staging`, `production`.
* شاخه‌های قابلیت به `main` ادغام می‌شوند.
* ارتقای کد از طریق جابجایی بین محیط‌ها.

### گردش کار

```
# توسعه قابلیت
git checkout -b feature-name main
# کار و کامیت
git push origin feature-name
# ایجاد درخواست MR به شاخه main

# بعد از ادغام در main
# استقرار در staging
git checkout staging
git merge main
git push origin staging

# بعد از تست در staging
# استقرار در production
git checkout production
git merge staging
git push origin production
```

### مزایا
* استقرار بر اساس محیط.
* مسیر ارتقای واضح کد.
* مناسب برای صنایع دارای قوانین سخت‌گیرانه.

### معایب
* شاخه‌های بیشتر برای مدیریت.
* نیاز به اتوماسیون.
* می‌تواند کندتر باشد.

## روش Trunk-Based Development

**مناسب برای**: تیم‌های با عملکرد بالا، استقرار مداوم (CD).

### استراتژی

* یک تنه واحد (Trunk): `main`.
* شاخه‌های قابلیت بسیار کوتاه‌مدت (کمتر از یک روز).
* استفاده از Feature Flags برای قابلیت‌های ناقص.

### گردش کار

```
# ایجاد شاخه کوتاه مدت
git checkout -b quick-fix main

# ایجاد تغییر کوچک
git commit -am "اصلاح رنگ دکمه"

# ادغام در همان روز
git checkout main
git merge quick-fix
git push origin main

# یا کامیت مستقیم روی main
# (با استفاده از CI و پرچم‌های قابلیت)
```

### مزایا
* سریع‌ترین زمان ادغام.
* کاهش تداخل‌های ادغام.
* تشویق به استفاده از CI/CD.
* کیفیت بالای کد.

### معایب
* نیاز به نظم و انضباط بالای تیمی.
* نیاز به CI/CD عالی.
* پیچیدگی مدیریت پرچم‌های قابلیت.

## روش Release Flow (مایکروسافت)

**مناسب برای**: نرم‌افزارهای سازمانی (Enterprise)، انتشار برنامه‌ریزی شده.

### استراتژی

* `main`: همیشه آماده انتشار.
* `release/*`: شاخه‌های تثبیت و تست نهایی.
* Topic branches: قابلیت‌های کوتاه مدت.

### گردش کار

```
# ایجاد شاخه موضوعی
git checkout -b users/name/feature main

# کار و ایجاد PR
git push origin users/name/feature

# ایجاد شاخه انتشار
git checkout -b release/v2.0 main

# انتخاب انتخابی (Cherry-pick) به شاخه انتشار
git cherry-pick <commit-hash>

# انتشار نهایی
git checkout main
git merge release/v2.0
git tag v2.0
```

### مزایا
* زمان‌بندی انتشار منعطف.
* توسعه و تثبیت موازی.
* مناسب برای مقیاس‌های سازمانی.

### معایب
* می‌تواند پیچیده باشد.
* نیاز به cherry-picking مکرر دارد.
* نگهداری بیشتر.

## انتخاب یک استراتژی

### روش GitHub Flow زمانی که:
* استقرار مداوم (CD) دارید.
* اپلیکیشن وب دارید.
* تیم کوچک دارید.
* تکرار (Iteration) سریع نیاز دارید.

### روش Git Flow زمانی که:
* انتشار برنامه‌ریزی شده دارید.
* اپلیکیشن موبایل یا دسکتاپ دارید.
* نیاز به پشتیبانی از چندین نسخه همزمان دارید.
* چرخه عمر سنتی نرم‌افزار را دنبال می‌کنید.

### روش GitLab Flow زمانی که:
* چندین محیط اجرایی دارید.
* استقرارهای مرحله‌بندی شده دارید.
* نیاز به رعایت قوانین نظارتی دارید.

### روش Trunk-Based زمانی که:
* تیم باتجربه دارید.
* CI/CD عالی دارید.
* استقرار مداوم دارید.
* فرکانس انتشار بسیار بالا دارید.

## قراردادهای نامگذاری شاخه

### شاخه‌های قابلیت (Feature)
```
feature/user-authentication
feature/dark-mode
feat/issue-123
```

### شاخه‌های اصلاح باگ (Bug Fix)
```
fix/login-error
bugfix/issue-456
hotfix/critical-security-patch
```

### شاخه‌های انتشار (Release)
```
release/1.0
release/2.0.0
release/v1.5
```

### سایر شاخه‌ها
```
docs/update-readme
test/integration-tests
refactor/database-layer
chore/update-dependencies
```

## دستورات مدیریت شاخه

### لیست کردن شاخه‌ها
```
# شاخه‌های محلی
git branch

# تمام شاخه‌ها (شامل ریموت)
git branch -a

# همراه با آخرین کامیت
git branch -v

# شاخه‌های ادغام شده
git branch --merged

# شاخه‌های ادغام نشده
git branch --no-merged
```

### حذف شاخه‌ها
```
# حذف شاخه محلی
git branch -d feature-name

# اجبار به حذف
git branch -D feature-name

# حذف شاخه راه دور
git push origin --delete feature-name
```

### تغییر نام شاخه
```
# تغییر نام شاخه فعلی
git branch -m new-name

# تغییر نام شاخه دیگر
git branch -m old-name new-name
```

## خلاصه امروز

انتخاب استراتژی صحیح شاخه‌بندی به تیم، پروژه و مدل استقرار شما بستگی دارد. هیچ راهکار "یکی برای همه" وجود ندارد. با یک استراتژی ساده مانند GitHub Flow شروع کنید و در صورت نیاز آن را تکامل دهید. کلید موفقیت، ثبات و ارتباطات است.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git checkout -b branch-name
* git merge --no-ff
* git cherry-pick
* git branch -m
* git branch --merged
* git branch --no-merged
* git push origin --delete

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: کار تیمی چندین نفر در یک مخزن راه دور](26.md)
* [روز بعد: درک فورک‌های GitHub و گردش کار Pull Request](28.md)

---
