# روز ۱۳: ذخیره‌سازی تغییرات در دایرکتوری کاری و ایندکس (Stash)

آیا تا به حال با این موقعیت مواجه شده‌اید: در نیمه راهِ توسعه یک سیستم هستید و ناگهان رئیس یا مشتری شما یک "دستور فوری" می‌دهد و از شما می‌خواهد که فوراً یک باگ را در یک سیستم موجود برطرف کنید یا قابلیتی را اضافه کنید؟ برنامه‌ای که در مقابل شماست در حال تکمیل شدن است و "مسئله فوری" رئیس را نمی‌توان به تأخیر انداخت. یک وضعیت توسعه نرم‌افزار ناقص به علاوه الزامات تنظیم اضطراری، به سادگی یک آزمایش بزرگ برای کیفیت نرم‌افزار است. اگر این مشکل را دارید، Git می‌تواند به شما کمک کند تا کار را به زیبایی به اتمام برسانید.

## درک دستور git stash

ما می‌دانیم که هنگام استفاده از کنترل نسخه Git، بین "دایرکتوری کاری" (working directory) و "ایندکس" (index) تفاوت وجود دارد. در دایرکتوری کاری، فایل‌هایی وجود خواهند داشت که شما نیمه‌کاره تغییر داده‌اید و تمام نشده‌اند (هنوز به ایندکس اضافه نشده‌اند)، و همچنین فایل‌های جدیدی وجود خواهند داشت که اضافه نشده‌اند (هنوز به ایندکس اضافه نشده‌اند). داده‌های قرار داده شده در ایندکس، محتوایی هستند که قصد دارید از طریق `git commit` یک نسخه (یک شیء کامیت) ایجاد کنید.

وقتی در نیمه راه توسعه یک قابلیت هستید و به طور ناگهانی کارتان قطع می‌شود، قطعاً عجله خواهید داشت، به خصوص که نمی‌دانید با آن برنامه‌های نیمه‌کاره‌ای که در دست دارید چه کنید. در Git، دستوری به نام `git stash` وجود دارد که می‌تواند به طور خودکار به شما کمک کند تا یک "نسخه خاص" (که آن هم یک شیء کامیت است) برای آن فایل‌های نیمه‌کاره ایجاد کنید. ما به این نسخه‌ها "نسخه‌های استش" (stash versions) می‌گوییم، یا می‌توانید مستقیماً آن‌ها را "نسخه‌های موقت" بنامید.

## ایجاد نسخه‌های استش (Creating Stash Versions)

فایل‌هایی که ما نیمه‌کاره تغییر داده‌ایم ممکن است حالت‌های زیر را داشته باشند:

* فایل‌های جدید (untracked files)
* فایل‌های جدید (فایل‌هایی که قبلاً به ایندکس اضافه شده‌اند) (tracked/staged files)
* فایل‌های تغییر یافته (فایل‌هایی که هنوز به ایندکس اضافه نشده‌اند) (tracked/unstaged files)
* فایل‌های تغییر یافته (فایل‌هایی که قبلاً به ایندکس اضافه شده‌اند) (tracked/staged files)
* فایل‌های حذف شده (فایل‌هایی که هنوز به ایندکس اضافه نشده‌اند) (tracked/unstaged files)
* فایل‌های حذف شده (فایل‌هایی که قبلاً به ایندکس اضافه شده‌اند) (tracked/staged files)

اگر می‌خواهید برای این فایل‌های نیمه توسعه یافته یک "نسخه موقت" ایجاد کنید، دو انتخاب دارید:

* `git stash` یک نسخه موقت برای تمام فایل‌های ردیابی شده (tracked files) ایجاد می‌کند.
* `git stash -u` شامل تمام فایل‌های ردیابی شده یا ردیابی نشده می‌شود، همه به عنوان یک نسخه موقت ایجاد خواهند شد.

**توجه**: `git stash` را می‌توان به صورت `git stash save` نیز نوشت. نتیجه این دو دستور یکسان است، فقط پارامتر `save` قابل حذف است.

### گردش کار مثال (Example Workflow)

در اینجا یک مثال کاربردی ساده آورده شده است:

```bash
# شما در حال کار روی قابلیت‌ها هستید
echo "new feature" > feature.txt
git add feature.txt

# ناگهان نیاز به رفع یک باگ دارید
# کارهای در جریان خود را استش کنید
git stash

# اکنون دایرکتوری کاری تمیز است
# باگ را در شاخه دیگری برطرف کنید
git checkout main
# ... اصلاحات را انجام دهید ...
git commit -m "Fix urgent bug"

# به کار روی قابلیت خود بازگردید
git checkout feature-branch
git stash pop  # کار خود را بازیابی کنید
```

## بازیابی تغییرات استش شده

پس از استش کردن تغییرات، می‌توانید به شاخه دیگری بروید یا روی کار فوری کار کنید. وقتی آماده ادامه کار اصلی خود شدید، می‌توانید تغییرات استش شده خود را با استفاده از دستورات زیر بازیابی کنید:

* `git stash pop` - آخرین استش را اعمال کرده و آن را از لیست استش حذف می‌کند.
* `git stash apply` - آخرین استش را اعمال می‌کند اما آن را در لیست استش نگه می‌دارد.

## لیست کردن تغییرات استش شده

برای دیدن مواردی که استش کرده‌اید، از دستور زیر استفاده کنید:

```
git stash list
```

این دستور تمام تغییرات استش شده را با مراجع استش آن‌ها (`stash@{0}`، `stash@{1}` و غیره) نشان می‌دهد.

## اعمال استش‌های خاص

اگر چندین استش دارید، می‌توانید با ارجاع به شماره آن، مورد خاصی را اعمال کنید:

```
git stash apply stash@{2}
```

## حذف استش‌ها

برای حذف یک استش خاص از لیست:

```
git stash drop stash@{0}
```

برای حذف تمام استش‌ها:

```
git stash clear
```

## استش کردن فایل‌های ردیابی نشده (Untracked Files)

به طور پیش‌فرض، `git stash` فقط فایل‌های ردیابی شده را استش می‌کند. برای استش کردن فایل‌های ردیابی نشده نیز:

```
git stash -u
```

یا برای استش کردن همه چیز از جمله فایل‌های نادیده گرفته شده (ignored files):

```
git stash -a
```

## ایجاد استش‌های نام‌گذاری شده

می‌توانید به استش خود یک پیام توضیحی بدهید:

```
git stash save "Work in progress on feature X"
```

این کار شناسایی استش‌ها را بعداً آسان‌تر می‌کند.

## مشاهده محتویات استش

برای دیدن موارد موجود در یک استش خاص بدون اعمال کردن آن:

```
git stash show stash@{0}
```

برای مشاهده تفاوت (diff) دقیق:

```
git stash show -p stash@{0}
```

## خلاصه امروز

دستور `git stash` یک ابزار بسیار کاربردی است که به شما امکان می‌دهد بدون نیاز به Commit، کار فعلی خود را موقتاً کنار بگذارید. این کار به ویژه زمانی مفیدی است که نیاز دارید سریعاً زمینه کاری خود را تغییر دهید تا روی چیز دیگری کار کنید. مکانیزم استش تضمین می‌کند که تغییرات در حال انجام شما به طور ایمن ذخیره شده و بعداً قابل بازیابی هستند.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git stash
* git stash save
* git stash -u
* git stash list
* git stash pop
* git stash apply
* git stash drop
* git stash clear
* git stash show

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: درک نام‌های نسبی اشیاء Git](12.md)
* [روز بعد: گزینه‌های پیکربندی Git for Windows](14.md)

---
