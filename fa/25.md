# روز ۲۵: مفاهیم استفاده از مخزن راه دور GitHub

بر اساس مبانی روز ۲۴، این مقاله مفاهیم و گردش‌های کاری مهم هنگام کار با مخازن راه دور GitHub را بررسی می‌کند.

## درک شاخه‌های ردیابی راه دور (Remote Tracking Branches)

شاخه‌های ردیابی راه دور، ارجاعاتی به وضعیت شاخه‌های راه دور هستند. آن‌ها از الگوی نامگذاری `<remote>/<branch>` پیروی می‌کنند:

```
# مشاهده تمام شاخه‌ها شامل شاخه‌های ردیابی راه دور
git branch -a

# خروجی نمونه:
# * main
#   feature
#   remotes/origin/main
#   remotes/origin/feature
```

## تفاوت Fetch در مقابل Pull

### Fetch

اشیاء و مراجع را از مخزن دیگری دانلود می‌کند اما آن‌ها را ادغام (merge) نمی‌کند:

```
git fetch origin
```

این دستور شاخه‌های ردیابی راه دور شما را به‌روز می‌کند اما دایرکتوری کاری شما را تغییر نمی‌دهد.

### Pull

اجرای Fetch + Merge در یک دستور:

```
git pull origin main
# معادل است با:
git fetch origin
git merge origin/main
```

یا همراه با ری‌بیس (rebase):

```
git pull --rebase origin main
```

## شاخه‌های بالادستی (Upstream Branches)

ردیابی بالادستی را تنظیم کنید تا دستورات push/pull ساده‌تر شوند:

```
# تنظیم upstream هنگام push کردن
git push -u origin feature-branch

# بعد از این می‌توانید فقط از دستورات زیر استفاده کنید:
git push
git pull
```

بررسی پیکربندی upstream:

```
git branch -vv
```

## ردیابی شاخه‌های راه دور (Tracking Remote Branches)

### ایجاد شاخه محلی از شاخه راه دور

```
# روش ۱: ردیابی خودکار
git checkout feature-branch
# اگر feature-branch در ریموت وجود داشته باشد، گیت به طور خودکار آن را ساخته و ردیابی می‌کند

# روش ۲: ردیابی صریح
git checkout -b feature-branch origin/feature-branch

# روش ۳: استفاده از پرچم track
git checkout --track origin/feature-branch
```

### لغو ردیابی یک شاخه راه دور

```
git branch --unset-upstream
```

## Push با نام‌های شاخه متفاوت

ارسال شاخه محلی به شاخه راه دور با نام متفاوت:

```
git push origin local-branch:remote-branch
```

## حذف شاخه‌های راه دور

حذف یک شاخه از ریموت:

```
# روش ۱
git push origin --delete branch-name

# روش ۲
git push origin :branch-name
```

## کار با چندین ریموت (Remote)

شما می‌توانید چندین ریموت داشته باشید (مثلاً origin و upstream):

```
# اضافه کردن ریموت upstream
git remote add upstream https://github.com/original/repo.git

# دریافت اطلاعات از upstream
git fetch upstream

# ادغام تغییرات upstream
git merge upstream/main

# ارسال به origin خودتان
git push origin main
```

## درک رفتارهای git push

حالت‌های مختلف push:

```
# ارسال شاخه فعلی به شاخه مشابه در ریموت
git config push.default simple  # پیش‌فرض در گیت ۲.۰ به بالا

# ارسال تمام شاخه‌های مشابه
git config push.default matching

# ارسال شاخه فعلی به شاخه‌ای با همان نام
git config push.default current

# هیچ ارسالی بدون مشخص کردن صریح انجام نشود
git config push.default nothing
```

## خطرات Force Push (ارسال با اجبار)

### چه زمانی Force Push کنیم؟

* شاخه قابلیت (feature branch) خود را ری‌بیس کرده‌اید.
* شما تنها کسی هستید که روی آن شاخه کار می‌کنید.
* نیاز دارید اشتباهی را در کامیت‌های ارسال شده اصلاح کنید.

### نحوه انجام Force Push

```
# روش استاندارد (خطرناک!)
git push -f origin feature-branch

# روش ایمن‌تر: force push همراه با اجاره (lease)
git push --force-with-lease origin feature-branch
```

`--force-with-lease` تنها در صورتی موفق می‌شود که ریموت از آخرین باری که اطلاعات را Fetch کرده‌اید، تغییر نکرده باشد.

### بهترین تجربه‌های Force Push

۱. **هرگز به شاخه اصلی (main/master) فورس-پوش نکنید**.
۲. قبل از فورس-پوش روی شاخه‌های مشترک، **ارتباط برقرار کنید**.
۳. به جای -f از **--force-with-lease** استفاده کنید.
۴. قبل از فورس-پوش یک **شاخه بکاپ** بسازید.
۵. فقط شاخه‌های قابلیت **متعلق به خودتان** را فورس-پوش کنید.

## مدیریت شاخه‌های منحرف شده (Diverged)

زمانی که شاخه محلی و راه دور از هم فاصله گرفته‌اند:

```
# بررسی وضعیت
git status

# روش ۱: ادغام تغییرات راه دور
git pull origin main

# روش ۲: ری‌بیس روی تغییرات راه دور
git pull --rebase origin main

# روش ۳: فورس-پوش (در صورت لزوم)
git push --force-with-lease origin feature-branch
```

## پاکسازی مراجع ردیابی راه دور (Prune)

حذف مراجعِ شاخه‌هایی که در ریموت حذف شده‌اند:

```
# مشاهده شاخه‌های منقضی شده
git remote prune origin --dry-run

# حذف شاخه‌های منقضی شده
git remote prune origin

# یا در هنگام fetch
git fetch --prune
```

## مخازن Bare در مقابل Non-Bare

### Non-Bare (مخزن کاری)

* دارای دایرکتوری کاری است.
* برای توسعه استفاده می‌شود.
* همان چیزی است که به طور معمول کلون می‌کنید.

### Bare (مخزن لخت)

* دایرکتوری کاری ندارد.
* فقط شامل داده‌های گیت است.
* روی سرورها استفاده می‌شود.

```
# ایجاد مخزن bare
git clone --bare project project.git

# یا مقداردهی به صورت bare
git init --bare project.git
```

## الگوهای گردش کار گیت (Workflows)

### گردش کار متمرکز (Centralized Workflow)

همه روی شاخه اصلی کار می‌کنند:

```
git pull origin main
# انجام تغییرات
git add .
git commit -m "تغییرات"
git push origin main
```

### گردش کار شاخه قابلیت (Feature Branch Workflow)

هر قابلیت شاخه خود را دارد:

```
git checkout -b feature-x
# کار روی قابلیت
git push origin feature-x
# ایجاد pull request
# بعد از ادغام، شاخه را حذف کنید
git branch -d feature-x
git push origin --delete feature-x
```

### گردش کار Gitflow

از چندین شاخه با طول عمر بالا استفاده می‌کند:

* **main**: کد آماده تولید.
* **develop**: شاخه ادغام.
* **feature/**: توسعه قابلیت‌ها.
* **release/**: آماده‌سازی انتشار.
* **hotfix/**: اصلاحات فوری.

## گردش کار Pull Request (درخواست ادغام)

۱. **فورک کردن** مخزن (برای پروژه‌های متن‌باز).
۲. **کلون کردن** فورک خودتان.
۳. **ایجاد شاخه قابلیت**.
   ```
   git checkout -b feature-name
   ```
۴. **انجام تغییرات و کامیت کردن**.
۵. **ارسال به فورک خودتان**.
   ```
   git push origin feature-name
   ```
۶. **ایجاد Pull Request** در GitHub.
۷. **بحث و بازبینی** کد.
۸. **انجام تغییرات درخواستی**.
۹. **ادغام زمان تایید نهایی**.

## به‌روز نگه داشتن فورک

```
# اضافه کردن ریموت بالادستی (فقط یکبار)
git remote add upstream https://github.com/original/repo.git

# دریافت تغییرات بالادستی
git fetch upstream

# ادغام upstream/main در main شما
git checkout main
git merge upstream/main

# ارسال به فورک خودتان
git push origin main
```

## حل تداخلات در Pull Request

```
# آپدیت شاخه خود با شاخه هدف
git fetch origin
git checkout feature-branch
git merge origin/main

# حل تداخلات
# ... ویرایش فایل‌ها ...
git add .
git commit -m "حل تداخلات"

# ارسال شاخه آپدیت شده
git push origin feature-branch
```

## خلاصه امروز

درک مفاهیم مخزن راه دور برای همکاری مؤثر حیاتی است. چه در یک تیم کار کنید و چه در پروژه‌های متن‌باز مشارکت داشته باشید، دانستن نحوه مدیریت ریموت‌ها، ردیابی شاخه‌ها و مدیریت تداخلات، شما را به یک کاربر موثرتر گیت تبدیل می‌کند.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git fetch origin
* git pull origin main
* git pull --rebase
* git push -u origin branch
* git push origin --delete branch
* git push --force-with-lease
* git branch -vv
* git branch --unset-upstream
* git remote prune origin
* git fetch --prune
* git clone --bare

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: استفاده از مخزن راه دور GitHub - شروع کار](24.md)
* [روز بعد: کار گروهی چندین نفر در یک مخزن راه دور](26.md)

---
