# روز ۲۹: نحوه وارد کردن پروژه‌های Subversion به مخزن Git

بسیاری از سازمان‌ها هنوز از Subversion (SVN) استفاده می‌کنند اما می‌خواهند به Git مهاجرت کنند. این مقاله توضیح می‌دهد که چگونه مخازن SVN را با حفظ کامل تاریخچه به Git منتقل کنید.

## چرا از SVN به Git مهاجرت کنیم؟

**مزایای Git**:
* گردش کار توزیع شده.
* عملیات سریع‌تر (به صورت محلی).
* شاخه‌بندی و ادغام بهتر.
* کار به صورت آفلاین.
* گردش‌های کاری منعطف‌تر.
* ابزارها و اکوسیستم بهتر.

**چالش‌ها**:
* منحنی یادگیری.
* مفاهیم متفاوت.
* تغییر در گردش کار.
* سازگاری تیم.

## استراتژی‌های مهاجرت

### ۱. وارد کردن سریع (ساده)

سریع است اما برخی از فراداده‌های (metadata) SVN را از دست می‌دهد:

```
# کلون کردن کل مخزن SVN
git svn clone http://svn.example.com/repo

# یا مشخص کردن ساختار trunk/branches/tags
git svn clone http://svn.example.com/repo --trunk=trunk --branches=branches --tags=tags
```

### ۲. وارد کردن اصولی (توصیه شده)

نویسندگان، شاخه‌ها و تگ‌ها را حفظ می‌کند:

```
# ایجاد فایل نویسندگان
# نگاشت کاربران SVN به کاربران Git
echo "svnuser1 = John Doe <john@example.com>" >> authors.txt
echo "svnuser2 = Jane Smith <jane@example.com>" >> authors.txt

# کلون کردن با فایل نویسندگان
git svn clone http://svn.example.com/repo \
  --authors-file=authors.txt \
  --trunk=trunk \
  --branches=branches \
  --tags=tags \
  --no-metadata
```

### ۳. استفاده از svn2git (آسان‌ترین راه)

نصب svn2git:

```
# در مک
brew install svn2git

# در لینوکس
gem install svn2git
```

ایجاد فایل نویسندگان:

```
# تولید لیست نویسندگان از SVN
svn log -q http://svn.example.com/repo | \
  awk -F '|' '/^r/ {print $2}' | \
  sort -u > authors.txt

# ویرایش فایل authors.txt برای افزودن آدرس ایمیل‌ها
# فرمت: svnuser = Full Name <email@example.com>
```

انجام مهاجرت:

```
# ایجاد پوشه جدید
mkdir git-repo
cd git-repo

# اجرای مهاجرت
svn2git http://svn.example.com/repo \
  --authors authors.txt
```

## فرآیند گام‌به‌گام مهاجرت

### فاز ۱: آماده‌سازی

```
۱. شناسایی ساختار مخزن SVN
۲. ایجاد فایل نگاشت نویسندگان (authors mapping)
۳. تصمیم‌گیری در مورد ساختار مخزن Git
۴. برنامه‌ریزی استراتژی شاخه/تگ
۵. برقراری ارتباط با تیم
```

### فاز ۲: تست مهاجرت

```
# ابتدا یک مهاجرت آزمایشی انجام دهید
git svn clone http://svn.example.com/repo test-migration

# بررسی و تایید:
- تاریخچه کامیت‌ها
- شاخه‌ها
- تگ‌ها
- محتوای فایل‌ها
```

### فاز ۳: ایجاد فایل نویسندگان

استخراج نویسندگان SVN:

```
svn log -q http://svn.example.com/repo | \
  grep "^r" | \
  awk '{print $3}' | \
  sort -u > svn-authors.txt
```

تبدیل به فرمت گیت:

```
# authors.txt
jdoe = John Doe <john.doe@example.com>
jsmith = Jane Smith <jane.smith@example.com>
admin = Administrator <admin@example.com>
```

### فاز ۴: انجام مهاجرت نهایی

```
# کلون کردن مخزن SVN
git svn clone http://svn.example.com/repo \
  --authors-file=authors.txt \
  --stdlayout \
  migrated-repo

cd migrated-repo

# تبدیل تگ‌های SVN به تگ‌های Git
git for-each-ref refs/remotes/tags | cut -d / -f 4- | \
while read tagname; do
  git tag "$tagname" "refs/remotes/tags/$tagname"
  git branch -r -d "tags/$tagname"
done

# تبدیل شاخه‌های SVN به شاخه‌های Git
git for-each-ref refs/remotes/origin | cut -d / -f 4- | \
while read branchname; do
  git branch "$branchname" "refs/remotes/origin/$branchname"
done

# حذف ریموت SVN
git remote rm origin
```

### فاز ۵: ارسال به مخزن راه دور Git

```
# اضافه کردن ریموت گیت
git remote add origin https://github.com/your-org/repo.git

# ارسال تمام شاخه‌ها
git push -u origin --all

# ارسال تمام تگ‌ها
git push -u origin --tags
```

## مدیریت موارد خاص

### مخازن حجیم

برای مخازن بزرگ، به صورت تدریجی وارد کنید:

```
# شروع از نسخه (revision) شماره ۱۰۰۰
git svn clone http://svn.example.com/repo \
  -r 1000:HEAD \
  --authors-file=authors.txt
```

### نادیده گرفتن مسیرها (Ignore)

ایجاد `.gitignore` بر اساس تنظیمات ignore در SVN:

```
# استخراج نادیده‌گرفته‌شده‌های SVN
git svn show-ignore > .gitignore

# کامیت کردن
git add .gitignore
git commit -m "افزودن .gitignore از تنظیمات SVN"
```

### فایل‌های باینری

SVN و Git با فایل‌های باینری به شکل متفاوتی برخورد می‌کنند:

```
# برای فایل‌های باینری بزرگ، استفاده از Git LFS را در نظر بگیرید
git lfs install
git lfs track "*.psd"
git lfs track "*.zip"
```

## پل ارتباطی SVN (git-svn)

همزمان با انتقال، به استفاده از SVN ادامه دهید:

```
# کلون با git-svn
git svn clone http://svn.example.com/repo

# کار عادی با گیت به صورت محلی

# دریافت آپدیت‌ها از SVN
git svn rebase

# ارسال به SVN
git svn dcommit
```

**گردش کار**:

```
# دریافت از SVN
git svn rebase

# انجام تغییرات
git add .
git commit -m "تغییرات"

# ارسال به SVN
git svn dcommit
```

## کارهای پس از مهاجرت

### ۱. تایید مهاجرت

```
# بررسی تعداد کامیت‌ها
git log --oneline | wc -l

# مقایسه با SVN
# باید مطابقت داشته باشد یا بسیار نزدیک باشد

# بررسی فایل‌های خاص
git log -- path/to/file.txt
svn log path/to/file.txt

# تایید شاخه‌ها
git branch -a

# تایید تگ‌ها
git tag
```

### ۲. به‌روزرسانی CI/CD

* به‌روزرسانی اسکریپت‌های ساخت.
* تغییر URLهای سیستم کنترل نسخه (VCS).
* به‌روزرسانی خط لوله (pipeline) استقرار.
* تست تمام فرآیندهای خودکار.

### ۳. آموزش تیم

* کارگاه مبانی گیت.
* مستندسازی گردش کار جدید.
* تمرین عملی.
* پشتیبانی در طول دوره انتقال.

### ۴. به‌روزرسانی مستندات

* به‌روزرسانی README.
* تغییر دستورالعمل‌های Checkout.
* به‌روزرسانی راهنمای مشارکت.
* مستندسازی گردش کار جدید.

## مقایسه: دستورات SVN در مقابل Git

```
# دریافت کد (Checkout)
SVN: svn checkout
Git: git clone

# به‌روزرسانی (Update)
SVN: svn update
Git: git pull

# ثبت تغییرات (Commit)
SVN: svn commit
Git: git commit + git push

# وضعیت (Status)
SVN: svn status
Git: git status

# تاریخچه (Log)
SVN: svn log
Git: git log

# ایجاد شاخه (Branch)
SVN: svn copy .../trunk .../branches/name
Git: git checkout -b name

# ایجاد تگ (Tag)
SVN: svn copy .../trunk .../tags/v1.0
Git: git tag v1.0

# ادغام (Merge)
SVN: svn merge
Git: git merge

# مشاهده تفاوت‌ها (Diff)
SVN: svn diff
Git: git diff
```

## عیب‌یابی (Troubleshooting)

### مشکل: کامیت‌های گم شده

```
# بررسی محدوده نسخه SVN
git svn log | head -n 20

# کلون مجدد از یک نسخه خاص
git svn clone -r START:HEAD ...
```

### مشکل: خطای نگاشت نویسندگان

```
# افزودن نویسندگان گم شده به authors.txt
# اجرای مجدد مهاجرت
```

### مشکل: حجم بالای دایرکتوری .git

```
# پاکسازی فایل‌های اضافی (Garbage collection)
git gc --aggressive --prune=now

# در نظر گرفتن shallow clone برای تاریخچه‌های بسیار قدیمی
```

## خلاصه امروز

مهاجرت از SVN به Git نیازمند برنامه‌ریزی و اجرای دقیق است. استفاده از ابزارهای مناسب مانند `svn2git` و حفظ نگاشت نویسندگان، انتقالی روان را تضمین می‌کند. برای تست مهاجرت، تایید نتایج و آموزش تیم خود در مورد گردش‌های کاری گیت وقت بگذارید.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git svn clone
* git svn rebase
* git svn dcommit
* git svn show-ignore
* git for-each-ref
* git gc --aggressive

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: درک فورک‌های GitHub و گردش کار Pull Request](28.md)
* [روز بعد: اشتراک‌گذاری نکات مفید کار با Git از تجربیات کاری](30.md)

---
