# روز ۰۱: درک کنترل نسخه Git

من نزدیک به ۱۰ سال از Subversion (SVN) استفاده می‌کردم و هرگز نیازی به تغییر به سایر پلتفرم‌های کنترل نسخه احساس نکردم تا چند سال پیش که به تدریج کنترل نسخه TFS (TFS Service) را در پاسخ به تغییرات مبتنی بر ابر معرفی کردم. این انتقال روان بود زیرا SVN و TFS مفاهیم کنترل نسخه مشابهی دارند و هر دو سیستم‌های کنترل نسخه متمرکز هستند. این سیستم‌های کنترل نسخه متمرکز ساده، بصری و مدیریت مجوزها (permissions) در آن‌ها آسان است. صادقانه بگویم، در بیشتر سناریوهای توسعه، Subversion یا TFS کاملاً کافی هستند. پس چه فرصت یا نیازی ما را مجبور کرد به کنترل نسخه Git سوئیچ کنیم؟ من معتقدم افراد مختلف دلایل خاص خود را برای پذیرش Git دارند - برخی آن را سرگرم‌کننده می‌دانند، برخی آن را تازه می‌بینند و برخی آن را قدرتمند می‌دانند. صرف نظر از این، تا زمانی که دلیل شما را به یادگیری فعالانه یک فناوری ناآشنا ترغیب می‌کند، خوب است. این مقاله نه تنها شما را با مکانیزم کنترل نسخه Git آشنا می‌کند، بلکه دلایل من برای تمایل به تغییر به Git را نیز به اشتراک می‌گذارد.

## هدف مقاله

در حوزه توسعه نرم‌افزار، کنترل نسخه (version control) کد منبع بسیار مهم است. برخلاف سیستم‌های کنترل نسخه متمرکز مانند Subversion یا TFVC (Team Foundation Version Control)، سیستم Git یک سیستم کنترل نسخه توزیع شده (DVCS; Distributed Version Control System) است که مزایای بسیاری را برای کنترل نسخه به ارمغان می‌آورد و نقاط ضعف کنترل نسخه متمرکز سنتی را حل می‌کند؛ از جمله پشتیبانی از عملیات محلی (local)، پشتیبان‌گیری آسان، شاخه‌سازی (branching) و ادغام (merging) قدرتمند و منعطف و موارد دیگر. با این حال، از آنجایی که کنترل نسخه Git هم در مفاهیم کنترل نسخه و هم در استفاده از ابزار با ابزارهای کنترل نسخه متمرکز سنتی تفاوت زیادی دارد، منحنی یادگیری (learning curve) قابل توجهی ایجاد می‌کند.

اگرچه موضوع این مقاله "تسلط بر Git در ۳۰ روز" است، اما صادقانه بگویم، این کمی اغراق‌آمیز است زیرا Git بسیار وسیع و عمیق است و جزئیات زیادی برای کاوش دارد. اگر واقعاً می‌خواهید آن را در کار به کار ببرید، چند روز یادگیری برای تسلط واقعی به آن نیاز است؟ یادگیری کمی در هر روز برای ۳۰ روز متوالی عدد معقولی به نظر می‌رسد (یا شاید خیلی زیاد؟). اگر ابزاری وجود داشته باشد که همه نیاز به استفاده از آن دارند و باید بلافاصله بر آن مسلط شوند، و اگر بعد از ۳۰ روز یادگیری هنوز نمی‌دانید چگونه از آن به صورت منعطف استفاده کنید، پس منحنی یادگیری خیلی تند است. بنابراین، من فکر می‌کنم تمرکز اصلی این سری مقالات "چگونه کنترل نسخه Git را در عرض ۳۰ روز یاد بگیریم و بتوانیم به طور ماهرانه در کارهای توسعه عملی به کار ببریم" است. این هدف واقعی این سری است. من به خصوص روی آن جزئیات خسته‌کننده تأکید نخواهم کرد، اما همیشه برخی مفاهیم و جزئیات مهم وجود دارند که نمی‌توان آن‌ها را نادیده گرفت. من سعی خواهم کرد در هر موضوع به برخی از آن‌ها اشاره کنم و در صورت وجود فرصت، آن‌ها را عمیقاً بررسی کنم. امیدوارم همه بتوانند با انجام دادن یاد بگیرند و جذابیت قدرتمند کنترل نسخه Git را عمیقاً تجربه کنند.

## فرصتی برای انتقال

در چند ماه گذشته، شرکت ما پروژه بزرگی با مشارکت بیش از ۱۲ توسعه‌دهنده داشت. در نهایت همه تصمیم گرفتند Git را به عنوان مکانیزم کنترل نسخه برای این پروژه اتخاذ کنند. به جای اینکه بگوییم کنترل نسخه Git را پذیرفتیم، دلیل واقعی پذیرش این بود که "ما انتخاب کردیم از GitHub به عنوان پلتفرم کنترل نسخه خود استفاده کنیم" زیرا پلتفرم GitHub واقعاً به خوبی یکپارچه شده است، با پشتیبانی کامل از کنترل نسخه Git، ردیابی و مدیریت مسائل (issue tracking)، مدیریت آنلاین اسناد Wiki و رابط کاربری دوستانه برای بررسی کد منبع (source code review). این ویژگی‌ها می‌توانند به طور مؤثری به ما در کاهش مشکلات ارتباطی تیم در طول توسعه مشترک چند نفره کمک کنند.

شروع کار با Git بسیار دشوار بود زیرا مفاهیم کنترل نسخه Git چنان با Subversion متفاوت است که درک شهودی تفاوت‌ها سخت است. حتی اگر یک رابط ابزار گرافیکی GUI به شما داده شود، لزوماً ممکن است ندانید چگونه از آن استفاده کنید. می‌دانید، وقتی ابزاری قدرتمند و کاربردی در دست دارید، "استفاده نادرست از آن" وحشتناک‌تر از "ندانستن نحوه استفاده از آن" است! به سادگی، شما ابتدا باید یک طرز فکر ایجاد کنید، اصول کار Git را درک کنید و سپس شروع به استفاده از ابزارهای مرتبط با Git (چه ابزارهای خط فرمان و چه ابزارهای رابط گرافیکی) کنید. این راه درست است!

## روش‌های یادگیری

وقتی برای اولین بار Git را یاد گرفتم، چندین کتاب خواندم (در واقع نکات کلیدی را انتخاب کردم)، همچنین بسیاری از مقالات آنلاین و ارائه‌ها را خواندم و حتی چندین ویدیوی آموزشی تماشا کردم. با تماشا و یادگیری، واقعاً توانستم نحوه استفاده از ابزارهای Git را یاد بگیرم و فکر نمی‌کردم خیلی سخت باشد. با این حال، Git دستورات و پارامترهای زیادی دارد که کاملاً فراتر از محدوده حافظه مغز است. مگر اینکه هر روز از آن استفاده کنید، چگونه می‌توانید تمام روز دستورات کنترل نسخه را تایپ کنید؟ اگر قرار باشد هر بار که می‌خواهید از یک دستور Git استفاده کنید، به کتاب نگاه کنید، این خیلی ناکارآمد است. در آن زمان، من به طور شهودی فکر می‌کردم که یادگیری Git در نهایت باید به ابزارهای GUI کاربردی بازگردد؛ در غیر این صورت، این چیز ممکن است برای ترویج در تیم آسان نباشد.

علاوه بر این، چون Git یک مکانیزم "کنترل نسخه توزیع شده" است، وقتی تعداد توسعه‌دهندگان شروع به افزایش می‌کند و هر نفر شروع به داشتن نسخه کپی خود از مخزن (repository) می‌کند، همه در طول اولین فرآیند شاخه‌سازی (branching) و ادغام (merging) چند نفره رنج می‌برند و این وضعیت برای مدتی طولانی ادامه می‌یابد. اگرچه اشتراک‌گذاری فنی در شرکت وجود داشت، اما چون همه برای اولین بار یاد می‌گرفتند، آن مفاهیم انتزاعی Git نمی‌توانستند عمیقاً در قلب مردم ریشه بدوانند. آن‌ها فقط می‌توانستند بر اساس روش‌های استفاده از Git، مانند نحوه استفاده از ابزارها، دستورات پرکاربرد، چه دستوراتی باید در موقعیت‌های خاص استفاده شوند و غیره، به اشتراک بگذارند. حتی اگر اصول پیچیده در طول فرآیند توضیح داده می‌شد، چون درک همه از Git هنوز مبهم بود، درک افراد مختلف از روش‌های کنترل نسخه Git یکسان نبود و دانش و مفاهیم جذب شده لزوماً سازگار نبودند. بنابراین حتی پس از دوره، همه هنوز به چندین روز زمان نیاز داشتند تا به طور مداوم سازگار شوند، با یکدیگر بحث کنند و مشکلات را با هم حل کنند. اگر شما تنها کسی هستید که از Git استفاده می‌کنید، واقعاً سخت است که مزایایی را که Git به ارمغان می‌آورد حس کنید و ممکن است نتوانید پایداری کنید.

بنابراین، من فکر می‌کنم که برای یادگیری خوب کنترل نسخه Git، ممکن است یادگیری آسان‌تر باشد اگر اول نکات زیر را بدانید:

* اول، مفاهیم اولیه Git را داشته باشید. یادگیری از طریق دستورات (commands) سریع‌ترین راه است. این بخش را نادیده نگیرید.
* افراد بیشتری را پیدا کنید تا کنترل نسخه Git را با شما یاد بگیرند، ترجیحاً مستقیماً در کارهای توسعه عملی از آن استفاده کنید.
* بهترین حالت این است که چند نفر پیشرو در تیم داشته باشید که بتوانند مفاهیم بیشتری از Git را یاد بگیرند تا با دیگران به اشتراک بگذارند یا زمانی که کسی گیر کرد، کمک به موقع ارائه دهند.
* درک کنید که Git "کنترل نسخه توزیع شده" است و همه یک مخزن (repository) کامل دارند، بنابراین باید فایل‌ها را به طور مکرر ادغام (merge) کنید.
* هنگام استفاده از Git، شاخه‌سازی (branching) و ادغام (merging) امری عادی است، اما هر زمان که ادغامی صورت می‌گیرد، تداخل (conflict) وجود خواهد داشت. یاد بگیرید چگونه تداخل‌ها را حل کنید.

## درک کنترل نسخه Git

گیت (Git) توسط لینوس توروالدز (Linus Torvalds)، پدر لینوکس، زمانی که در حال توسعه هسته لینوکس بود، ایجاد شد. از آنجایی که روش‌های کنترل نسخه اولیه بسیار ناکارآمد و متمرکز بودند، هنگام مدیریت کنترل نسخه برای پروژه‌های پیچیده و بزرگ مانند هسته لینوکس، مشکلات زیادی به وجود آمد. اولین هسته لینوکس از BitKeeper برای کنترل نسخه استفاده می‌کرد، اما بعداً لینوس توروالدز بر اساس تجربه خود با BitKeeper و Monotone، سیستم کنترل نسخه بهتر Git را طراحی کرد. در ابتدا، Git فقط به عنوان یک ابزار کنترل نسخه سطح پایین طراحی شده بود تا به عنوان یک ابزار عملیاتی برای سایر سیستم‌های کنترل نسخه (SCM) استفاده شود و بعدها به تدریج به یک سیستم کنترل نسخه کامل تبدیل شد.

جالب اینجاست که وقتی لینوس توروالدز برای اولین بار به Git برای کنترل نسخه سوئیچ کرد، Git بسیار پیچیده بود و بسیاری از مفاهیم کنترل نسخه با قبل تفاوت زیادی داشت که با مخالفت جوامع متن‌باز (open source) در سراسر جهان نیز روبرو شد. با این حال، پس از سال‌ها تلاش و توسعه، ابزارهای کار با Git بیشتر و بیشتر پخته شدند و به تدریج مخالفت‌ها فروکش کرد. بر اساس تحقیقات بازار در سال ۲۰۱۳، ۳۰ درصد از پروژه‌های متن‌باز در سراسر جهان به Git برای کنترل نسخه کوچ کرده‌اند. این یک سهم بازار شگفت‌انگیز است، به این معنی که Git قطعاً ویژگی‌های خیره‌کننده‌ای دارد و لازم است آن را به خوبی مطالعه کنیم!

صحبت از معماری Git که باشد، کاملاً بر اساس تجربه لینوس توروالدز در نگهداری پروژه‌های بزرگی مانند هسته لینوکس و تجربه غنی او در بهینه‌سازی سیستم فایل است. به همین دلیل، Git شامل طراحی‌های مهم زیر است:

* پشتیبانی قوی از مدل‌های توسعه غیرخطی (مدل‌های توسعه توزیع شده)
  * گیت دارای مکانیزم شاخه‌سازی (branching) و ادغام (merging) سریع است، از جمله ابزارهای گرافیکی برای نمایش مسیر تاریخی تغییرات نسخه.
  * گیت بر شاخه‌سازی و ادغام بسیار تأکید دارد، بنابراین در فرآیند کنترل نسخه، شما به طور مداوم عملیات شاخه‌سازی و ادغام را انجام خواهید داد.
  * مکانیزم شاخه‌سازی Git بسیار سبک و بدون بار اضافی است. هر شاخه (branch) فقط یک اشاره‌گر مرجع به یک Commit خاص است.
* مدل توسعه توزیع شده (Distributed development model)
  * هر کسی که در توسعه Git مشارکت می‌کند، یک تاریخچه توسعه کامل خواهد داشت.
  * وقتی یک توسعه‌دهنده برای اولین بار یک مخزن (repository) گیت را Clone می‌کند، این کاملاً معادل یک "پشتیبان کامل" از این مخزن گیت است.
  * تمام فایل‌های تغییر یافته و سوابق تاریخی در کل مخزن در مخزن محلی (local repository) ذخیره می‌شوند.
* سازگار با سیستم‌عامل‌های موجود
  * یک مخزن Git در واقع فقط یک پوشه با فایل‌های پیکربندی مرتبط و فایل‌های مختلف blob object است.
  * مخازن Git را می‌توان به هر روشی منتشر کرد، بنابراین می‌توانید از HTTP، FTP، rsync، SSH یا حتی پروتکل Git به عنوان رسانه‌ای برای دسترسی به مخازن Git با سازگاری بسیار بالا استفاده کنید.
* مدیریت کارآمد پروژه‌های بزرگ
  * از آنجایی که یک مخزن کامل در ماشین محلی Clone می‌شود و مخزن حاوی فایل‌های کامل و سوابق تغییر نسخه است، سرعت عملیات‌های مختلف فایل در کنترل نسخه صدها برابر سریع‌تر از دسترسی مستقیم از راه دور خواهد بود.
  * این همچنین به این معنی است که کنترل نسخه Git با بزرگتر شدن پروژه‌ها و بیشتر شدن فایل‌ها کند نمی‌شود.
* محافظت از سوابق تاریخی
  * در فرآیند کنترل نسخه Git، هر Commit یک شماره hash id تولید می‌کند و هر نسخه در فرآیند تغییر به این hash id ارجاع می‌دهد. تا زمانی که hash id مطابقت نداشته باشد، Git کار نخواهد کرد. بنابراین با بزرگتر شدن پروژه و Clone شدن نسخه‌های بیشتری از مخزن، شما به سختی می‌توانید محتوای فایل یا سوابق نسخه را دستکاری کنید.
  * **به یاد داشته باشید: همه یک مخزن کامل دارند. اگر نسخه اصلی را تغییر دهید، مخزن هیچ‌کس دیگر نمی‌تواند به مخزن اصلی مرجوع شود، بنابراین به سختی می‌توانید سوابق نسخه را به طور خودسرانه دستکاری کنید.**
* طراحی مبتنی بر ابزار (Toolkit-based design)
  * گیت به عنوان مجموعه‌ای از نرم‌افزارهای ابزاری (ابزارهای خط فرمان) طراحی شده است. شما می‌توانید به راحتی استفاده از ابزارهای مختلف را با انعطاف‌پذیری فوق‌العاده ترکیب کنید.
* استراتژی‌های ادغام پلاگین‌پذیر (Pluggable merge strategies)
  * گیت دارای یک مکانیزم "ادغام ناقص" با طراحی خوب و الگوریتم‌های متعددی است که می‌توانند ادغام را کامل کنند و در نهایت به کاربر اطلاع می‌دهد که چرا ادغام خودکار نمی‌تواند کامل شود یا به شما اطلاع می‌دهد که ادغام دستی مورد نیاز است.
* مکانیزم جمع‌آوری زباله غیرفعال (Passive garbage collection mechanism)
  * هنگام استفاده از Git، اگر می‌خواهید عملیات فعلی را قطع کنید یا عملیات قبلی را بازیابی کنید، امکان‌پذیر است. لازم نیست نگران استفاده از دستور اشتباه یا کرش کردن دستور در حین اجرا باشید.
  * مکانیزم جمع‌آوری زباله (garbage collection) Git در واقع همان فایل‌های بی‌استفاده باقی‌مانده در سیستم فایل است. این مکانیزم فقط پس از انباشته شدن این اشیاء بی‌استفاده برای مدتی به طور خودکار اجرا می‌شود، یا می‌توانید خودتان دستوراتی برای پاکسازی آن‌ها صادر کنید. به عنوان مثال: `git gc --prune`
* بسته‌بندی منظم اشیاء (Regular packing of objects)
  * "اشیایی" (objects) که در Git نام می‌بریم در واقع نشان‌دهنده فایل‌ها در مخزن هستند. در فرآیند تغییرات نسخه، کد یا سایر فایل‌های پروژه به‌روزرسانی می‌شوند. هر بار که به‌روزرسانی می‌شود، تا زمانی که محتوای فایل متفاوت باشد، یک "شیء" جدید ایجاد می‌شود و تمام این فایل‌ها با محتوای متفاوت حفظ می‌شوند.
  * می‌توانید تصور کنید که با بزرگتر شدن یک پروژه و داشتن نسخه‌های بیشتر، اشیاء بیشتر و بیشتری وجود خواهد داشت. اگرچه هر فایل را می‌توان به صورت جداگانه فشرده کرد تا فایل کوچکتر شود، اما تعداد زیاد فایل‌ها باعث می‌شود دسترسی به فایل‌ها کمتر و کمتر کارآمد باشد. بنابراین، طراحی Git دارای مکانیزمی است که می‌تواند به طور خودکار مجموعه‌ای از "اشیاء" قدیمی را در یک packfile بسته‌بندی کند تا کارایی دسترسی به فایل بهبود یابد.
  * آن فایل‌های جدیداً اضافه شده همچنان به عنوان فایل‌های تکی وجود خواهند داشت، که به این معنی است که یک "فایل" در یک مخزن Git یک "شیء" Git است، اما باید هر از چند گاهی دوباره بسته‌بندی شود.
  * احتمالاً گیت به طور خودکار کارهایی مانند بررسی و بسته‌بندی مجدد را انجام می‌دهد، اما همچنان می‌توانید خودتان دستوراتی برای اجرای آن‌ها صادر کنید. به عنوان مثال: `git gc`
  * اگر می‌خواهید بررسی کنید که آیا سیستم فایل نگهداری شده توسط Git کامل است، می‌توانید دستور زیر را اجرا کنید: `git fsck`

در مورد سیستم کنترل نسخه توزیع شده Git، اجازه دهید چند مورد را تکرار کنم:

* گیت می‌تواند بدون پشتیبانی سمت سرور (server-side) به طور کامل کنترل نسخه را انجام دهد زیرا همه یک کپی کامل از مخزن را دارند.
* چون همه یک کپی کامل از مخزن را دارند، هر بار که تغییرات نسخه را ثبت (Commit) می‌کنید، فقط در مخزن محلی ثبت می‌شود، بنابراین سرعت Commit بسیار بالا است و نیازی به اتصال شبکه ندارید که می‌تواند زمان توسعه را به شدت صرفه‌جویی کند.
* از آنجایی که همه یک کپی کامل از مخزن را دارند، این بدان معنی است که هنگام استفاده از کنترل نسخه Git، چیزی به نام "کنترل دسترسی" (permission control) وجود ندارد. هر عضو می‌تواند مخزن را Clone کند و تغییرات را به صورت محلی بدون هیچ محدودیت دسترسی ثبت کند. هنگام استفاده از Git، تنها مجوزی که می‌توان تنظیم کرد این است که آیا شما اجازه دسترسی به مخزن بالادستی (upstream) یا مخزن راه دور (remote repository) را دارید یا خیر.
* اگر نیاز به تبادل نسخه‌های تغییر یافته با دیگران دارید، می‌توانید در هر زمان از طریق "ادغام" (merging) این کار را انجام دهید. گیت قابلیت‌های ردیابی ادغام بسیار قدرتمندی دارد.
* برای ادغام نسخه‌های چندین نفر، فقط باید اجازه یا دسترسی به مخزن مشترک را داشته باشید.
  **به عنوان مثال: در همان سرور، می‌توانید از طریق مجوزهای پوشه به اشتراک بگذارید، یا از راه دور به مخزن Git سرور دیگری از طریق SSH دسترسی پیدا کنید، یا مخازن Git را از طریق وب‌سرورها و غیره به اشتراک بگذارید.**

## خلاصه امروز

مقاله امروز فقط یک معرفی کلی بود. اگر فلسفه طراحی Git را کاملاً درک نمی‌کنید، مهم نیست. می‌توانید بعد از مدتی استفاده به این مقاله برگردید و ممکن است درک عمیق‌تری داشته باشید.

فکر می‌کنم نوشتن "درک کنترل نسخه Git" بسیار دشوارتر از آموزش نحوه استفاده از آن به همه است. در زیر برخی از لینک‌های مرتبط با Git برای یادگیری بیشتر آورده شده است.

## لینک‌های مرجع

* [Git (software) - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/Git_(software) "Git (software) - Wikipedia, the free encyclopedia")
* [Pro Git Book](https://progit.org/)
* [Git Magic - Traditional Chinese Version](https://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_tw/)
* [Version control - Wikipedia](https://en.wikipedia.org/wiki/Version_control)

---

* [بازگشت به فهرست مطالب](README.md)
* [روز بعد: سه ابزار ضروری Git برای پلتفرم ویندوز](02.md)

---
