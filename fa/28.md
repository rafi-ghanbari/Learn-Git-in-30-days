# روز ۲۸: درک فورک‌های GitHub و گردش کار Pull Request

فورک‌ها (Forks) و درخواست‌های ادغام (Pull Requests) اساس همکاری در پروژه‌های متن‌باز در GitHub هستند. این مقاله توضیح می‌دهد که چگونه می‌توانید در پروژه‌هایی که اجازه دسترسی مستقیم (write access) به آن‌ها را ندارید، مشارکت کنید.

## درک مفهوم Fork

فورک یک کپی کامل از یک مخزن (repository) تحت حساب کاربری خودتان در GitHub است. فورک به شما اجازه می‌دهد:
* بدون تأثیرگذاری بر پروژه اصلی، آزادانه آزمایش کنید.
* از طریق درخواست‌های Pull Request، تغییرات خود را پیشنهاد دهید.
* پروژه را بر اساس نیازهای خود سفارشی کنید.

## مقایسه Fork در مقابل Clone در مقابل Branch

* **Fork**: کپی مخزن در GitHub (تحت حساب شما).
* **Clone**: کپی مخزن در سیستم محلی شما.
* **Branch**: ایجاد یک خط توسعه مجزا و منحرف شده.

## فورک کردن یک مخزن

### در وب‌سایت GitHub

۱. به مخزن مورد نظر بروید.
۲. روی دکمه "Fork" (بالا سمت راست) کلیک کنید.
۳. انتخاب کنید که فورک کجا ایجاد شود (حساب شخصی یا سازمان).
۴. منتظر بمانید تا GitHub فورک را ایجاد کند.

### کلون کردن فورک خودتان

```
# کلون کردن فورک شما
git clone https://github.com/your-username/repo-name.git

# رفتن به دایرکتوری پروژه
cd repo-name

# اضافه کردن ریموت اصلی (upstream)
git remote add upstream https://github.com/original-owner/repo-name.git

# بررسی ریموت‌ها
git remote -v
# origin    https://github.com/your-username/repo-name.git (fetch)
# origin    https://github.com/your-username/repo-name.git (push)
# upstream  https://github.com/original-owner/repo-name.git (fetch)
# upstream  https://github.com/original-owner/repo-name.git (push)
```

## گردش کار کامل Pull Request

### مرحله ۱: همگام‌سازی فورک (Sync)

```
# دریافت تغییرات از مخزن اصلی (upstream)
git fetch upstream

# رفتن به شاخه اصلی خودتان
git checkout main

# ادغام تغییرات بالادستی
git merge upstream/main

# آپدیت کردن فورک در GitHub
git push origin main
```

### مرحله ۲: ایجاد شاخه قابلیت (Feature Branch)

```
# ایجاد و رفتن به شاخه جدید
git checkout -b fix-typo-in-readme

# انجام تغییرات
# ویرایش فایل‌ها...

# آماده‌سازی تغییرات
git add README.md

# کامیت کردن تغییرات
git commit -m "اصلاح غلط املایی در دستورالعمل نصب"
```

### مرحله ۳: ارسال به فورک خودتان

```
# ارسال شاخه به فورک شما در GitHub
git push origin fix-typo-in-readme
```

### مرحله ۴: ایجاد Pull Request

۱. در GitHub به صفحه فورک خود بروید.
۲. روی دکمه "Compare & pull request" کلیک کنید.
۳. جزئیات PR را پر کنید:
   * **عنوان**: شرح کوتاه و واضح.
   * **توضیحات**: چه چیزی، چرا و چگونه.
   * ارجاع به Issueها در صورت وجود.
۴. روی "Create pull request" کلیک کنید.

### مرحله ۵: پاسخ به بازخوردها

```
# انجام تغییرات درخواستی
# ویرایش فایل‌ها...

# کامیت تغییرات جدید
git add .
git commit -m "اعمال بازخوردهای بازبینی"

# ارسال آپدیت‌ها
git push origin fix-typo-in-readme
# درخواست PR به طور خودکار آپدیت می‌شود!
```

### مرحله ۶: بعد از ادغام نهایی

```
# جابجایی به شاخه اصلی
git checkout main

# دریافت تغییرات ادغام شده
git pull upstream main

# آپدیت فورک خودتان
git push origin main

# حذف شاخه محلی و راه دور
git branch -d fix-typo-in-readme
git push origin --delete fix-typo-in-readme
```

## به‌روز نگه داشتن فورک

### همگام‌سازی منظم

```
# دریافت و ادغام در یک دستور
git checkout main
git pull upstream main
git push origin main
```

### همگام‌سازی خودکار

از دکمه "Fetch upstream" در صفحه فورک خود در GitHub استفاده کنید، یا از GitHub Actions استفاده نمایید:

```yaml
# .github/workflows/sync-upstream.yml
name: Sync Fork
on:
  schedule:
    - cron: '0 0 * * *'  # روزانه
  workflow_dispatch:
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: TobKed/github-forks-sync-action@v1
        with:
          upstream: original-owner/repo-name
          target: your-username/repo-name
```

## چندین کامیت در یک PR

### روش ۱: ری‌بیس تعاملی (Interactive Rebase)

```
# فشرده‌سازی (Squash) کامیت‌ها
git rebase -i HEAD~3

# در ویرایشگر، کلمه 'pick' را به 'squash' برای کامیت‌هایی که می‌خواهید ترکیب شوند تغییر دهید
# ذخیره کرده و پیام کامیت نهایی را ویرایش کنید

# ارسال با اجبار (به دلیل بازنویسی تاریخچه)
git push -f origin feature-branch
```

### روش ۲: ریست نرم (Soft Reset)

```
# بازگشت به قبل از کامیت‌های خودتان
git reset --soft HEAD~3

# ایجاد یک کامیت واحد و کامل
git commit -m "پیاده‌سازی کامل قابلیت"

# ارسال با اجبار
git push -f origin feature-branch
```

## مدیریت تداخل ادغام در Pull Requestها

```
# همگام‌سازی با مخزن اصلی
git fetch upstream

# ری‌بیس روی شاخه اصلی مخزن اصلی
git rebase upstream/main

# حل تداخل‌ها در صورت وجود
# ویرایش فایل‌های دارای تداخل
git add resolved-files
git rebase --continue

# ارسال با اجبار
git push -f origin feature-branch
```

## پیش‌نویس Pull Request (Draft)

برای گرفتن بازخوردهای زودهنگام، PR را به صورت پیش‌نویس ایجاد کنید:

۱. موقع ایجاد PR، روی فلش کنار دکمه "Create pull request" کلیک کنید.
۲. "Create draft pull request" را انتخاب کنید.
۳. وقتی کار تمام شد، آن را به عنوان آماده (Ready) علامت بزنید.

مزایا:
* دریافت بازخورد در حین کار.
* نمایش کارهای در حال انجام.
* جلوگیری از ادغام تصادفی کدهای ناتمام.

## بهترین تجربه‌ها در Pull Request

### قبل از ایجاد PR

- [ ] کد به درستی کار می‌کند و تست شده است.
- [ ] استایل کدنویسی پروژه رعایت شده است.
- [ ] مستندات به‌روز شده‌اند.
- [ ] کامیت‌ها تمیز و منطقی هستند.
- [ ] شاخه با شاخه اصلی (main) به‌روز است.

### نوشتن PR خوب

**عنوان**:
```
❌ اصلاح کد
✅ اصلاح خطای Null Pointer در ورود کاربر
```

**توضیحات**:
```
## چه چیزی
اصلاح خطای Null Pointer که وقتی کاربران با رمز عبور خالی وارد می‌شدند، رخ می‌داد.

## چرا
گزارش باگ شماره ۱۲۳ خرابی در تلاش‌های نامعتبر برای ورود را نشان می‌داد.

## چگونه
افزودن بررسی Null قبل از اعتبارسنجی رمز عبور.

## تست‌ها
- تست با رمز عبور خالی
- تست با رمز عبور معتبر
- تست با رمز عبور نامعتبر

بسته می‌شود: #123
```

### در طول بازبینی

* به تمام کامیت‌ها پاسخ دهید.
* اگر چیزی مبهم است سوال بپرسید.
* تغییرات درخواستی را سریعاً انجام دهید.
* نسبت به پیشنهادات پذیرا باشید.
* از بازبین‌ها تشکر کنید.

## مشارکت در پروژه‌های متن‌باز

### پیدا کردن پروژه

۱. **GitHub Explore**: https://github.com/explore
۲. **First Timers Only**: https://www.firsttimersonly.com/
۳. **Good First Issue**: جستجو در GitHub
۴. **Up For Grabs**: https://up-for-grabs.net/

### قبل از مشارکت

۱. فایل `CONTRIBUTING.md` را بخوانید.
۲. Issueهای باز را بررسی کنید.
۳. به PRهای موجود نگاهی بیندازید.
۴. مرام‌نامه (Code of Conduct) را درک کنید.
۵. محیط توسعه را راه اندازی کنید.

### اولین Pull Request شما

از موارد کوچک شروع کنید:
* اصلاح غلط‌های املایی.
* بهبود مستندات.
* افزودن تست‌ها.
* اصلاح باگ‌های واضح.

### ساختن اعتبار

۱. با مستندات شروع کنید.
۲. باگ‌های خوب گزارش دهید.
۳. در بخش Issueها به دیگران کمک کنید.
۴. PRهای باکیفیت ارسال کنید.
۵. صبور و محترم باشید.

## اشتباهات رایج که باید از آن‌ها اجتناب کرد

۱. **همگام نکردن فورک**: همیشه قبل از ایجاد PR خود را به‌روز کنید.
۲. **تغییرات بیش از حد**: PRها را روی یک موضوع متمرکز نگه دارید.
۳. **نبود توضیحات**: توضیح دهید چه کاری و چرا انجام دادید.
۴. **ارسال با اجبار به شاخه اصلی**: هرگز این کار را نکنید.
۵. **بحث کردن با نگهدارندگان پروژه**: محترم باشید.
۶. **تست نکردن**: همیشه تغییرات خود را تست کنید.

## خلاصه امروز

فورک‌ها و درخواست‌های Pull Request همکاری عظیم در دنیای متن‌باز را ممکن می‌سازند. درک این گردش کار راه هزاران پروژه را برای مشارکت شما باز می‌کند. از موارد کوچک شروع کنید، صبور باشید و به یاد داشته باشید که هر مشارکت‌کننده باتجربه‌ای، زمانی مبتدی بوده است.

اجازه دهید دستورات گیت و پارامترهای یاد گرفته شده امروز را دوباره سازماندهی کنم:

* git clone <fork-url>
* git remote add upstream <original-url>
* git fetch upstream
* git merge upstream/main
* git push origin branch-name
* git push -f origin branch-name
* git rebase -i HEAD~n
* git reset --soft HEAD~n

---

* [بازگشت به فهرست مطالب](README.md)
* [روز قبل: کنترل نسخه از طریق شاخه‌ها در مخزن راه دور یکسان](27.md)
* [روز بعد: نحوه وارد کردن پروژه‌های Subversion به مخزن Git](29.md)

---
